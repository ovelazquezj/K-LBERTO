â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PASO 5 v8 - RESUMEN DE RESULTADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Timestamp: 20251227_200045
Tiempo total de ejecuciÃ³n: 93m 58s
CÃ³digo de salida: 0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONFIGURACIÃ“N DEL ENTRENAMIENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Epochs: 10 (AUMENTADO de 5 para que crezcan logits)
  Batch size: 8
  Learning rate: 5e-05
  Seq length: 128
  Optimizer: BertAdam
  Loss function: NLLLoss con class_weights
  Dropout: 0.5 (AGREGADO a output layers)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DATASET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Train: 900 samples
  Dev/Test: 225 samples cada uno

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LOSS DURANTE ENTRENAMIENTO (CSV)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
epoch,step,avg_loss
1,100,1.456
2,100,2.743
3,100,2.663
4,100,2.577
5,100,2.416
6,100,2.138
7,100,1.966
8,100,1.756
9,100,1.616
10,100,1.520

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MATRIZ DE CONFUSIÃ“N - FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
VERIFICACIÃ“N DE COLAPSO A CLASE MAYORITARIA
================================================================================
Clase mayoritaria en dataset: 0
Frecuencia de clase mayoritaria: 0.4235
Accuracy actual del modelo: 0.5596
Diferencia: 0.1361

âœ“ Modelo estÃ¡ discriminando entre clases (diferencia > 0.05)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
F1 SCORES POR CLASE - FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Label 0: 0.562, 0.877, 0.685
Label 1: 0.795, 0.302, 0.438
Label 2: 0.429, 0.296, 0.350
Label 3: 0.420, 0.407, 0.413

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ACCURACY FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Acc. (Correct/Total): 0.5596 (366/654) 

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICACIÃ“N DE COLAPSO A CLASE MAYORITARIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICACIÃ“N DE COLAPSO A CLASE MAYORITARIA
================================================================================
Clase mayoritaria en dataset: 0
Frecuencia de clase mayoritaria: 0.4235
Accuracy actual del modelo: 0.3532
Diferencia: 0.0703

âœ“ Modelo estÃ¡ discriminando entre clases (diferencia > 0.05)
================================================================================

Start evaluation on test dataset.
Loading sentences from /home/omar/projects/K-LBERTO/datasets/tass_spanish/test.tsv
There are 654 sentence in total. We use 1 processes to inject knowledge into sentences.
Progress of process 0: 0/654
The number of evaluation instances:  654

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PRÃ“XIMOS PASOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Revisar F1 scores para clases 1, 2, 3:
   - Si F1 > 0.3 para alguna clase: âœ“ Modelo estÃ¡ aprendiendo
   - Si F1 = 0 para todas: âœ— Sigue colapsando

2. Revisar logits finales (mÃ¡s grandes que v6?):
   - v6: rango [-1.2, +1.3] (muy pequeÃ±os)
   - v7: esperar rango mÃ¡s grande o distribuciÃ³n mÃ¡s peaky

3. Revisar confusion matrix:
   - Si predicciones solo en clase 0: modelo colapsa
   - Si predicciones en clases 1,2,3: modelo discrimina

4. Revisar verificaciÃ³n de colapso:
   - Si ALERTA: investigar knowledge graph o learning rate
   - Si âœ“: continuar a PASO 6 (ablation studies)

5. Comparar loss progression:
   - v6: 1.482 â†’ 1.638 â†’ 1.608 â†’ 1.586 â†’ 1.573 (aumenta en epoch 2)
   - v7: esperar que baje monotÃ³nicamente

DECISIÃ“N:
- Si loss baja continuamente: âœ“ Ajuste exitoso, evaluar resultados finales
- Si F1 > 0.3 en clases 1-3: âœ“ PASO 6 (ablation studies)
- Si F1 0.15-0.30: PASO 8b (aumentar cobertura KG a 5-10%)
- Si diverge nuevamente: PASO 8c (investigar arquitectura/embeddings)

AJUSTES APLICADOS v7 â†’ v8:
- Learning rate: 5e-05 â†’ 1e-05 (5x menor para convergencia estable)
- Dropout: 0.5 â†’ 0.3 (menos agresivo, mayor flexibilidad)
- RazÃ³n: Dataset 2.4x mÃ¡s grande requiere gradientes mÃ¡s pequeÃ±os
- Esperado: Loss baja monÃ³tonamente (NO diverge como v7)

Si v8 diverge de nuevo:
- Revisar inicializaciÃ³n de pesos en embedding layers
- Verificar que visible_matrix en KnowledgeGraph no estÃ© colapsada
- Considerar warm-up learning rate (primeras Ã©pocas con LR mÃ¡s alto)
- Investigar si KG causa distorsiÃ³n en embeddings intermedios

# Resumen en pantalla
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "RESUMEN FINAL"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ“ Entrenamiento completado en ${MINUTES}m ${SECONDS}s"
echo ""
echo "ğŸ“Š Archivos de resultado:"
echo "  - Full log: $FULL_LOG"
echo "  - Debug log: $DEBUG_LOG"
echo "  - Loss CSV: $LOSS_CSV"
echo "  - Metrics summary: $METRICS_FILE"
echo ""
echo "ğŸ” Para revisar resultados:"
echo "  cat $METRICS_FILE"
echo ""
echo "ğŸ“ˆ Para ver loss progression:"
echo "  cat $LOSS_CSV"
echo ""
echo "ğŸ› Para ver debug details:"
echo "  tail -100 $FULL_LOG | grep -A 5 'DEBUG'"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Salir con el cÃ³digo de error original si hubo problema
if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "âš ï¸  ADVERTENCIA: El script finalizÃ³ con cÃ³digo de error: $EXIT_CODE"
    exit $EXIT_CODE
fi

echo ""
echo "âœ… PASO 5 v8 COMPLETADO"
echo ""
